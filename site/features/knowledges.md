# 知识管理

知识管理模块提供了对知识库的管理，支持用户上传文件型知识、人工录入的知识、URL爬取的知识。知识上传到知识库被训练之后，有两种主要的使用途径：

1. 为Pilot提供知识，消除大模型由于数据的时效性、准确性等原因产生的幻觉问题。可以认为我们给智能运维助理装载了私域知识，让它执行技能的时候能够更加符合我们的期望
2. 为外部应用提供混合检索+ReRank的能力。有些时候，第三方应用仅仅只需要使用混合知识检索，典型的场景是告警推荐，这个时候第三方应用并不需要使用Pilot那么丰富的能力，它只是希望能够通过告警检索最佳的匹配方案，并且能够预览原文

## 知识库

知识库是知识的聚合，由多个种类的知识聚合而成，并且利用各种算法提升知识索引的准确性。在知识库管理的过程，我们主要关注以下几个方面：

* 哪些知识组成了这个知识库
* 如何使用混合检索+ReRank，让检索变得更加准确
* 混合搜索的时候，语义检索和文本检索的权重是如何分配的
* 对知识使用怎么样的分块模式

总的来说，我们会在知识库这里对知识加工进行精细化的配置，以供LLM技能使用。

![知识1.png](https://static.cwoa.net/785762b0748349fcac9d5385586ddca2.png)

如下图，在知识库需要选择使用的模型等参数，具体说明如下
  * 基本信息：包括知识库的名称、描述
  * Embeding模型：选择用于知识库构建和检索的Embed模型，提供了内置的四类Embed模型，可根据任务和需求选择合适的模型。
  * 分块解析：设置分块解析的参数，包括分块大小和分块重叠。将输入文本分成多个块，并指定块的大小和重叠部分，以便更好地处理长文本。
  * 语义分块解析：选择使用Embed模型进行语义分块解析。这可以帮助机器人更好地理解和处理输入文本，并将其分解为不同的语义块。
  * 文本检索：设置文本检索的权重。可以为知识库中的不同文本部分设置不同的权重，以影响检索结果的排序和相关性。
  * 向量检索：设置向量检索的参数，包括检索权重、返回数量和候选数量。通过调整这些参数，可以控制向量检索的影响力、返回结果的数量以及候选结果的数量。
  * 结果重排序：选择Rerank模型和返回结果的数量。通过启用Rerank模型并设置结果数量，可以对检索到的结果进行再排序，从而提供更准确和相关的答案。
  * 知识：可以使用`文件知识`、`手工录入`、`网页知识`三类知识

![知识1-1.png](https://static.cwoa.net/cf8285e7f1a24bc6a237750f343ea69c.png)

![知识1-2.png](https://static.cwoa.net/f083663b1f034f4fa12771f8553b46ae.png)

![知识1-3.png](https://static.cwoa.net/284c3cca77754984b4b551fbb35b26e3.png)

## 知识

OpsPilot能够管理知识，包括 `文件知识`、`手工录入`、`网页知识`，并供知识库使用。

### 文本知识

在日常运维过程中，会产生多种类型的知识，他们一般会以文件类型存在，这也是OpsPilot知识库中最主要的私域知识来源。OpsPilot支持对以下知识进行知识解析

* Markdown
* Word
* Excel
* CSV
* PPT
* TXT

![知识2.png](https://static.cwoa.net/433dca6382d94445ac965e54aa63d1e4.png)

### 手工录入

* 运维脚本的代码段、零散的碎片知识，都适合用手工录入的方式形成知识，让OpsPilot能够对其进行使用

![知识3.png](https://static.cwoa.net/53b66500fc65457b8afe6b6b1fb767b9.png)

### 网页知识

互联网上有非常多有用的知识，例如RabbitMQ的官方文档、Redis的官方文档，这些软件会因为对应版本的不一样，具备不一样的特性，或者具备不一样的命令行参数，这种时候我们可以使用网页知识，对他们进行快速、持续的知识捕获

![知识4.png](https://static.cwoa.net/913fe9c790a74f969828b3344ededb96.png)

## API

### 知识检索

> POST  /api/knowledge_search/search/

```
{
  "knowledgebase_folder_ids": [
    1
  ],
  "query": "能监控Linux吗",
  "metadata":{
    "doc_type":"text"
  }
}
```

参数说明

| 变量                     | 描述                             |
| ------------------------ | -------------------------------- |
| knowledgebase_folder_ids | 知识库的ID号数组                 |
| query                    | 搜索语句                         |
| metadata                 | 知识库元数据过滤条件字典，可不填 |
